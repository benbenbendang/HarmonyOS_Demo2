import promptAction from '@ohos.promptAction'

// å…¼å®¹ç±»å‹
interface DatePickerResult {
  year: number;
  month: number;
  day: number;
}

@Component
export struct HealthPage {
  @State school: string = ''
  @State gradeIndex: number = 0
  @State birthDate: Date = new Date(2008, 0, 1)
  @State exerciseMinutes: number = 30
  @State agree: boolean = false

  private grades: string[] = ['ä¸€å¹´çº§', 'äºŒå¹´çº§', 'ä¸‰å¹´çº§', 'å››å¹´çº§', 'äº”å¹´çº§', 'å…­å¹´çº§']
  private readonly startDate: Date = new Date(1980, 0, 1)
  private readonly endDate: Date = new Date(2035, 11, 31)

  build() {
    Scroll() {
      Column() {
        // é¡¶éƒ¨æ ‡é¢˜
        Text('ğŸ« å­¦ç”Ÿå¥åº·ä¿¡æ¯ç™»è®°è¡¨')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor(0xFF1E88E5)
          .margin({ top: 20, bottom: 20 })
          .alignSelf(ItemAlign.Center)

        // è¡¨å•å¡ç‰‡
        Column({ space: 20 }) {
          // å­¦æ ¡åç§°
          Column() {
            Text('å­¦æ ¡åç§°')
              .fontSize(16).fontWeight(FontWeight.Medium)
              .margin({ bottom: 6 })
            TextInput({ placeholder: 'è¯·è¾“å…¥å­¦æ ¡åç§°', text: this.school })
              .width('100%').height(44)
              .padding({ left: 12 })
              .backgroundColor('#F7F9FC')
              .borderRadius(10)
              .onChange((v: string) => { this.school = v })
          }

          Divider().strokeWidth(0.5).color('#E0E0E0')

          // å¹´çº§
          Column() {
            Text('é€‰æ‹©å¹´çº§')
              .fontSize(16).fontWeight(FontWeight.Medium)
              .margin({ bottom: 6 })
            TextPicker({ range: this.grades, selected: this.gradeIndex })
              .onChange((value: string | string[], index: number | number[]) => {
                const idx = Array.isArray(index) ? index[0] : index
                if (typeof idx === 'number') this.gradeIndex = idx
              })
            Text(`å½“å‰é€‰æ‹©ï¼š${this.grades[this.gradeIndex]}`)
              .fontSize(14).fontColor(Color.Gray).margin({ top: 6 })
          }

          Divider().strokeWidth(0.5).color('#E0E0E0')

          // å‡ºç”Ÿæ—¥æœŸ
          Column() {
            Text('å‡ºç”Ÿæ—¥æœŸ')
              .fontSize(16).fontWeight(FontWeight.Medium)
              .margin({ bottom: 6 })
            DatePicker({
              start: this.startDate,
              end: this.endDate,
              selected: this.birthDate
            })
              .onChange((res: DatePickerResult) => {
                this.birthDate = new Date(res.year, res.month - 1, res.day)
              })
            Text(`å·²é€‰æ‹©ï¼š${this.birthDate.getFullYear()}å¹´${this.birthDate.getMonth() + 1}æœˆ${this.birthDate.getDate()}æ—¥`)
              .fontSize(14).fontColor(Color.Gray).margin({ top: 6 })
          }

          Divider().strokeWidth(0.5).color('#E0E0E0')

          // è¿åŠ¨æ—¶é•¿
          Column() {
            Text('æ¯æ—¥è¿åŠ¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰')
              .fontSize(16).fontWeight(FontWeight.Medium)
              .margin({ bottom: 6 })
            Slider({ value: this.exerciseMinutes, min: 0, max: 180, step: 10 })
              .onChange((v: number) => { this.exerciseMinutes = v })
            Text(`${this.exerciseMinutes} åˆ†é’Ÿ`)
              .fontSize(14).fontColor(0xFF1E88E5).margin({ top: 6 })
          }

          Divider().strokeWidth(0.5).color('#E0E0E0')

          // åè®®
          Row({ space: 8 }) {
            Toggle({ type: ToggleType.Checkbox, isOn: this.agree })
              .onChange((v: boolean) => { this.agree = v })
            Text(this.agree ? 'å·²åŒæ„éšç§åè®®' : 'æœªåŒæ„éšç§åè®®')
              .fontSize(14)
              .fontColor(this.agree ? 0xFF4CAF50 : Color.Red)
          }

          // æäº¤æŒ‰é’®
          Button('æäº¤ä¿¡æ¯')
            .width('100%').height(46)
            .backgroundColor(0xFF1E88E5)
            .fontColor(Color.White)
            .fontWeight(FontWeight.Bold)
            .borderRadius(23)
            .shadow({ radius: 6, color: 0x33000000, offsetX: 0, offsetY: 3 })
            .onClick(() => {
              if (!this.agree) {
                promptAction.showToast({ message: 'è¯·å…ˆåŒæ„éšç§åè®®' })
                return
              }
              const y = this.birthDate.getFullYear()
              const m = this.birthDate.getMonth() + 1
              const d = this.birthDate.getDate()
              const grade = this.grades[this.gradeIndex]
              promptAction.showToast({
                message: `æäº¤æˆåŠŸï¼š${this.school} / ${grade} / ${y}-${m}-${d} / ${this.exerciseMinutes}åˆ†é’Ÿ`
              })
            })
        }
        .width('90%')
        .padding(20)
        .backgroundColor(Color.White)
        .borderRadius(16)
        .shadow({ radius: 10, color: 0x22000000, offsetX: 0, offsetY: 6 })
        .margin({ bottom: 30 })
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)
    }
    .width('100%').height('100%')
    .backgroundColor('#F0F4F8')
  }
}
