import promptAction from '@ohos.promptAction'

interface Homework {
  name: string
  title: string
  content: string
  status: string
  tech: string
}

@Component
export struct HomeworkPage {
  @State name: string = ''
  @State title: string = ''
  @State content: string = ''
  @State status: string = 'æœªå®Œæˆ'
  @State tech: string = ''
  @State submissions: Homework[] = []

  build() {
    Scroll() {
      Column({ space: 20 }) {
        // ðŸ”¹ é¡µé¢æ ‡é¢˜
        Text('ðŸ“˜ å­¦ç”Ÿä½œä¸šæäº¤è¡¨å•')
          .fontSize(24)
          .fontWeight(FontWeight.Bold)
          .fontColor('#1E3A8A')
          .margin({ top: 20, bottom: 10 })
          .alignSelf(ItemAlign.Center)

        // ðŸ”¹ è¡¨å•å¡ç‰‡
        Column({ space: 18 }) {
          // è¾“å…¥é¡¹å°è£…
          this.renderInput('å§“å', 'è¯·è¾“å…¥å§“å', this.name, v => this.name = v)
          this.renderInput('æ ‡é¢˜', 'è¯·è¾“å…¥ä½œä¸šæ ‡é¢˜', this.title, v => this.title = v)
          this.renderTextArea('å†…å®¹', 'è¯·è¾“å…¥ä½œä¸šè¯¦ç»†å†…å®¹...', this.content, v => this.content = v)

          // æ˜¯å¦å®Œæˆ
          Column({ space: 8 }) {
            Text('æ˜¯å¦å®Œæˆ').fontSize(16).fontWeight(FontWeight.Medium)
            Row({ space: 20 }) {
              this.renderRadio('å·²å®Œæˆ', this.status === 'å·²å®Œæˆ', () => this.status = 'å·²å®Œæˆ')
              this.renderRadio('æœªå®Œæˆ', this.status === 'æœªå®Œæˆ', () => this.status = 'æœªå®Œæˆ')
            }
          }

          // ä½¿ç”¨æŠ€æœ¯
          Column({ space: 8 }) {
            Text('ä½¿ç”¨æŠ€æœ¯').fontSize(16).fontWeight(FontWeight.Medium)
            Column({ space: 10 }) {
              this.renderRadio('ArkTS', this.tech === 'ArkTS', () => this.tech = 'ArkTS')
              this.renderRadio('JavaScript', this.tech === 'JavaScript', () => this.tech = 'JavaScript')
              this.renderRadio('CSS', this.tech === 'CSS', () => this.tech = 'CSS')
            }
          }

          // æäº¤æŒ‰é’®
          Button('æäº¤ä½œä¸š')
            .width('100%').height(50)
            .fontSize(18).fontWeight(FontWeight.Bold)
            .backgroundColor('#3B82F6')
            .fontColor(Color.White)
            .borderRadius(25)
            .shadow({ radius: 6, color: 0x33000000, offsetX: 0, offsetY: 3 })
            .onClick(() => {
              if (this.name.trim() === '' || this.title.trim() === '') {
                promptAction.showToast({ message: 'è¯·è¾“å…¥å§“åå’Œæ ‡é¢˜' })
                return
              }
              const hw: Homework = {
                name: this.name,
                title: this.title,
                content: this.content,
                status: this.status,
                tech: this.tech
              }
              this.submissions = [hw, ...this.submissions]
              promptAction.showToast({ message: `âœ… æäº¤æˆåŠŸ: ${this.title}` })

              // æ¸…ç©º
              this.name = ''
              this.title = ''
              this.content = ''
              this.status = 'æœªå®Œæˆ'
              this.tech = ''
            })
        }
        .width('90%')
        .padding(20)
        .backgroundColor(Color.White)
        .borderRadius(16)
        .shadow({ radius: 10, color: 0x22000000, offsetX: 0, offsetY: 6 })

        // ðŸ”¹ æäº¤è®°å½•å±•ç¤º
        if (this.submissions.length > 0) {
          Column({ space: 12 }) {
            Text('ðŸ“ æœ€è¿‘æäº¤è®°å½•')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#1E3A8A')
              .margin({ bottom: 6 })

            ForEach(this.submissions, (item: Homework, index: number) => {
              Column({ space: 4 }) {
                Text(`${item.name} - ${item.title}`)
                  .fontSize(16).fontWeight(FontWeight.Medium).fontColor(Color.Black)
                Text(`å†…å®¹: ${item.content}`)
                  .fontSize(14).fontColor(Color.Gray)
                Text(`çŠ¶æ€: ${item.status} ï½œ æŠ€æœ¯: ${item.tech}`)
                  .fontSize(14).fontColor('#2563EB')
              }
              .width('100%')
              .padding(14)
              .backgroundColor('#F9FAFB')
              .borderRadius(12)
              .shadow({ radius: 4, color: 0x22000000, offsetX: 0, offsetY: 2 })
            }, (item: Homework) => item.title + item.name)
          }
          .width('90%')
        }
      }
      .width('100%')
      .alignItems(HorizontalAlign.Center)
      .padding({ bottom: 30 })
    }
    .width('100%').height('100%')
    .backgroundColor('#EEF2FF')
  }

  // ===== å°è£…ä¸€äº›æŽ§ä»¶ï¼Œå‡å°‘é‡å¤ =====
  @Builder
  private renderInput(label: string, placeholder: string, value: string, onChange: (v: string) => void) {
    Column() {
      Text(label).fontSize(16).fontWeight(FontWeight.Medium).margin({ bottom: 6 })
      TextInput({ placeholder: placeholder, text: value })
        .onChange(v => onChange(v))
        .width('100%').height(44)
        .padding({ left: 12 })
        .backgroundColor('#F3F4F6')
        .borderRadius(8)
    }
  }
  @Builder
  private renderTextArea(label: string, placeholder: string, value: string, onChange: (v: string) => void) {
    Column() {
      Text(label).fontSize(16).fontWeight(FontWeight.Medium).margin({ bottom: 6 })
      TextInput({ placeholder: placeholder, text: value })
        .onChange(v => onChange(v))
        .width('100%').height(100)
        .padding({ left: 12, top: 10 })
        .backgroundColor('#F3F4F6')
        .borderRadius(8)
    }
  }
  @Builder
  private renderRadio(text: string, checked: boolean, onSelect: () => void) {
    Row({ space: 8 }) {
      Radio({ value: text, group: text })
        .checked(checked)
        .onChange(isChecked => { if (isChecked) onSelect() })
      Text(text).fontSize(15)
    }
  }
}
